---
title: 'Assignment 4: Exploratory report on juvenile snowshoe hares in Bonanza Creek
  Experimental Forest'
author: "Mia Guarnieri"
date: "11/7/2021"
output: 
  html_document: 
    number_sections: yes
    toc: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(here)
library(lubridate)
library(dplyr)
library(effsize)
library(kableExtra)
library(ggbeeswarm)
library(broom)
```

# Introduction

A 4 - 5 sentence "mini-introduction" to what this study is exploring, including basic background information about the subject, site and study (with citations as needed), and a brief overview of what is included in the exploratory report. You should probably do this last so you know what's contained in the report.


Description:	bonrip -- Bonanza Riparian is a flood zone along the Tanana River and Bonanza Mature is a mature black spruce forest approximately 1 km inland from the river and 2 km from the riparian plot. Bonanza Riparian consisted of willow (Salix spp.), paper birch (Betula papyrifera), alder (Alnus spp.), white spruce (Picea glauca), fireweed (Epilobium augustifolium) and several grasses. Site used for live-trapping snowshoe hares to monitor abundance and survival.. Site alternate names:

Description:	bonmat -- Bonanza Mature consisted of stands of mature white spruce, paper birch, and alder, as well as black spruce (Picea mariana), Labrador tea (Ledum groenlandicum), willows, and prickly rose (Rosa acicularis).. Site alternate names:

Description:	bonbs -- Site used for live-trapping snowshoe hares to monitor abundance and survival. Located in a mature lowland black spruce stand..


# Data and analyses

A 3 - 4 sentence section in which you briefly describe the data, including citation & credit as needed, and provide an overview of the main analysis, statistical methods and tools used.

# Juvenile hare initial investigation

## Annual juvenile hare trap counts

This basic bar plot depicts the total number of juvenile hares trapped in each year of the study.

```{r}
#read in the hare data
bonanza_hares <- read.csv(here("Data", "bonanza_hares.csv"))

#create a dataframe with only juvenile hare counts

juv_hares_year <- bonanza_hares %>% 
  filter(age == "j") %>% #keeping only observations for juvenile hares
  mutate(date = mdy(date), #change date column to have class "Date"
         year = year(date)) %>% #add a new column named "year" with just the observation years
 group_by(year) #telling R to group the data by year

#visualize this data with a bar graph

ggplot(data = juv_hares_year, aes(x = year)) +
  geom_bar(fill = "skyblue4") +
  labs(x = "Year",
       y = "Juvenile Hares Observed") +
  scale_x_continuous(breaks = seq(from = 1999, to = 2021, by = 1)) +
  theme(axis.text.x = element_text(angle = 90))

#make a new object containing only counts of juvenile hares by year
juv_hares_annual_count <- juv_hares_year %>% 
  count(year)
```

**Figure 1:** The total number of juvenile snowshoe hares observed each year at the Bonanza Creek Long Term Ecological Research site between `r min(juv_hares_annual_count$year)` and `r max(juv_hares_annual_count$year)`. Data: Keilland et al. (2017).

### Takeaway

The maximum number of juvenile hares trapped in one year during this period was `r max(juv_hares_annual_count$n)` during `r juv_hares_annual_count[juv_hares_annual_count$n == max(juv_hares_annual_count$n), ]$year`, and the minimum number of juvenile hares trapped in one year was 0 during 2002 and 2009. The mean number of juvenile hares trapped per year is `r mean(juv_hares_annual_count$n)`, and the median is `r median(juv_hares_annual_count$n)`. The annual number of juvenile hares trapped generally decreased per year, particularly between 1999 and 2000. It is important to note than sampling effort can have an impact on the apparent number of trapped individuals. In future analyses, to ensure that data trends are a result of trends in the populations, sampling effort should be standardized between years (i.e., an equal number of traps should be set, for an equal number of days).

## Visualizing juvenile hare weights by sex and site

Create a finalized data visualization (or visualizations) in which you compare **juvenile hare weights by sex and site (grid)** (ignore other variables). You should include groups where these variables are not recorded (`NA`). Include finalized figure captions below your visualization(s).

```{r}
#formatting the data so labels show up appropriately in graph
juv_hares_boxplot_data <- juv_hares_year %>% 
  group_by(sex, grid) %>% 
  mutate(sex = case_when(
    sex %in% "f" ~ "Female",
    sex %in% "m" ~ "Male",
    sex %in% NA ~ "Unknown")) %>% 
  mutate(grid = case_when(
    grid %in% "bonbs" ~ "Bonanza Black Spruce",
    grid %in% "bonmat" ~ "Bonanza Mature",
    grid %in% "bonrip" ~ "Bonanza Riparian"))

#make a boxplot of juvenile hare weights by site, with scatterplot points mapped to it
ggplot(data = juv_hares_boxplot_data, aes(x = sex, y = weight, fill = sex)) +
  scale_fill_manual(values = c("mistyrose", "lightsteelblue", "lightgrey")) +
  geom_boxplot(outlier.color = "black") +
  geom_beeswarm(shape = 1, alpha = 0.65, aes(color = sex)) +
  scale_color_manual(values = c("palevioletred", "steelblue", "gray42")) +
  facet_wrap(~grid) +
  labs(y = "Body weight (g)",
       x = "Sex") +
  stat_summary(fun = mean, geom = "point", shape = 18, size = 2.5) +
  theme(legend.position = "none")

```

**Figure 2:** A boxplot of body weights of juvenile snowshoe hares observed at the Bonanza Creek Long Term Ecological Research site between `r min(juv_hares_boxplot_data$year)` and `r max(juv_hares_boxplot_data$year)`, grouped by sex and by observation site. Individual data points are overlaid to show general trends.Box endpoints indicate the 25th and 75th percentile values; the middle black line and black diamond within the box indicate the median and mean value for each sex, respectively. The whiskers correspond to the maximum (upper whisker) and minimum (lower whisker) values, not including outliers (solid black dots). Data: Keilland et al. (2017).

**Table 1:** Summary statistics table of body weight data of juvenile snowshoe hares observed at the Bonanza Creek Long Term Ecological Research site between `r min(juv_hares_boxplot_data$year)` and `r max(juv_hares_boxplot_data$year)`, grouped by sex and by observation site. Only one dead hare of unknown sex was recovered from the Bonanza Black Spruce site, and no weight was taken, so a median value cannot be calculated once N/A values are removed (hence the NaN "Not a Number" value recorded in the table), and other values are N/A. Data: Keilland et al. (2017).

```{r}
#make a summary table with juvenile hare weights by sex and site

juv_hares_sex_site_table <- juv_hares_boxplot_data %>% #start with the boxplot data (so groups have proper names)
  group_by(sex, grid) %>% #grouping by sex and site (grid)
  summarize(Mean = mean(weight, na.rm = TRUE), #designating a column for means
            Median = median(weight, na.rm  =TRUE), #and one for medians
            Standard_Deviation = sd(weight, na.rm = TRUE), #and one for standard deviations
            Count = n()) %>% #and finally one for counts
  kable(digits = c(2, 2, 2, 2), #setting the number of digits for each column; similar to `round()`)
        col.names = c("Sex", "Site", "Mean (g)", "Median (g)", "Standard Deviation (g)", "Sample Size"), #naming columns
        align = "llcccc") %>% #aligning the values centrally except for the species column (left aligned)
  kable_styling(full_width = FALSE, position = "center", bootstrap_options = c("striped", "hover")) #setting it to not take up the full page width and be center aligned, creating alternate shading for rows to make it easier to see

#call up the table

juv_hares_sex_site_table
```

### Takeaway

Median and mean juvenile body weights were higher for male snowshoe hares than female snowshoe hares at all three sites. Female hares tended to have more body weight values in the upper quartile (between the median and the 75th percentile), while male hares tended to have more body weight values in the lower quartile (between the median and the 25th percentile). Male and female hares are largest at the Black Spruce site, with higher mean and median body masses than hares at the other two sites. Body weight measurements of juvenile hares of unknown sex only occurred at the Bonanza Riparian and Bonanza Mature sites, and hares of unknown sex had much lower mean and median weights than either male or female hares at the Bonanza Riparian site.

## Weight comparison of juvenile snowshoe hares by sex

Body weight (in grams) was compared between the sexes in this data table. Sampling site is not included as a variable, but should be investigated in the future. A Cohen's d test (`cohen.d()`) and a Welch two-sample t-test (`t.test()`) were run on the samples of male and female hare weights to determine the size and significance of sex on juvenile hare body weight. Diagnostic plots (not included) revealed the data to be normally distributed.


**Table 2:** Summary statistics table of body weight data of juvenile snowshoe hares observed at the Bonanza Creek Long Term Ecological Research site between `r min(juv_hares_boxplot_data$year)` and `r max(juv_hares_boxplot_data$year)`, grouped by sex. Data: Keilland et al. (2017).

```{r echo = FALSE, results = TRUE, warnings = FALSE,message = FALSE}
#make a summary table with juvenile hare weights by sex

juv_hares_sex_table <- juv_hares_boxplot_data %>% #start with the boxplot data (so groups have proper names)
  filter(sex %in% c("Male", "Female")) %>% #filtering for only male and female observations
  group_by(sex) %>% #grouping by sex 
  summarize(Mean = mean(weight, na.rm = TRUE), #designating a column for means
            Median = median(weight, na.rm  =TRUE), #and one for medians
            Standard_Deviation = sd(weight, na.rm = TRUE), #and one for standard deviations
            Count = n()) %>% #and finally one for counts
  kable(digits = c(2, 2, 2, 2), #setting the number of digits for each column; similar to `round()`)
        col.names = c("Sex", "Mean (g)", "Median (g)", "Standard Deviation (g)", "Sample Size"), #naming columns
        align = "llcccc") %>% #aligning the values centrally except for the species column (left aligned)
  kable_styling(full_width = FALSE, position = "center", bootstrap_options = c("striped", "hover")) #setting it to not take up the full page width and be center aligned, creating alternate shading for rows to make it easier to see

#call up the table
juv_hares_sex_table
```


```{r}
#exploring normality using a histogram
ggplot(data = juv_hares_boxplot_data, aes(x = weight)) +
  geom_histogram() + 
  facet_wrap(~ sex) #females look very normal, males look slighly more uniform or even bimodal

#exploring normality using a Q-Q plot
ggplot(data = juv_hares_boxplot_data, aes(sample = weight)) +
  geom_qq() +
  facet_wrap(~ sex) #all look fairly linear, safe to assume residuals are normally distributed

#estimating effect size with cohen's d test and significance with a t test
juv_hares_male <- juv_hares_boxplot_data %>% #start with boxplot data so names are correct
  filter(sex == "Male") %>% #keep only data for male hares
  pull(weight) %>%  #pull out weight values
  na.omit() #remove NA values

juv_hares_female <- juv_hares_boxplot_data %>% #start with boxplot data so names are correct
  filter(sex == "Female") %>% #keep only data for female hares
  pull(weight) %>%  #pull out weight values
  na.omit() #remove NA values

juv_hares_all <- c(juv_hares_female, juv_hares_male)

cohen_d_test <- cohen.d(juv_hares_male, juv_hares_female) #run the cohen's d test

t_test <- t.test(juv_hares_male, juv_hares_female) #run a two-sample t-test

```

### Takeaway

Mean weight for male hares (`r round(mean(juv_hares_male), 2)` g) is `r round(mean(juv_hares_male) - mean(juv_hares_female), 2)` g (`r round(abs(1-(mean(juv_hares_male)/mean(juv_hares_female)))*100, 2)`%) larger than mean weight for female hares (`r round(mean(juv_hares_female), 2)` g). According to the `cohen.d()` and `t.test()` run on the data, the effect of sex on body weight is small (Cohen's d = `r round(cohen_d_test$estimate, 2)`) but statistically significant (`r t_test$method`: p = `r round(t_test$p.value, 2)`). A p value of `r round(t_test$p.value, 2)` suggests that there is a `r round((t_test$p.value * 100), 2)` percent chance that if our male and female hare populations did have the same mean, the sample means would be at least `r round(mean(juv_hares_male) - mean(juv_hares_female), 2)` g different.

## Exploring the relationship between juvenile weight and hind foot length

```{r}
#creating a plot of hind foot length (x) vs. juv weight (y)

ggplot(data = juv_hares_year, aes(x = hindft, 
                            y = weight)) +
  geom_point(shape = 18, size = 2) + 
  geom_smooth(method = "lm", color = "turquoise4") +
  labs(x = "Hind Foot Length (mm)",
       y = "Weight (g)")

#set up the model equation
juv_hare_lm <- lm(data = juv_hares_year, weight ~ hindft)

#make it tidy
juv_hare_lm_tidy <- tidy(juv_hare_lm)

#call it up
juv_hare_lm_tidy

#use glance to see summary statistics of the lm
juv_hare_lm_glance <- glance(juv_hare_lm)

#call it up
juv_hare_lm_glance

#get Pearson's R
juv_hares_pearson <- cor.test(data = juv_hares_year, juv_hares_year$hindft, juv_hares_year$weight)

juv_hares_pearson
```

```{r}
#running exploratory diagnostic plots to test for heteroscedasticity and normality
plot(juv_hare_lm)
```

**Figure 2:** Relationship between hind foot length (mm) and weight (g) of juvenile snowshoe hares observed at the Bonanza Creek Long Term Ecological Research site between `r min(juv_hares_year$year)` and `r max(juv_hares_year$year)`. Diamonds correspond to individual hare observations. Linear model summary: $\beta_1$ = `r round(juv_hare_lm_tidy$estimate[2], 2)` g/mm, p < 0.001, $R^2$ = `r round(juv_hare_lm_glance$r.squared, 2)`, Pearson's *r* = `r round(juv_hares_pearson$estimate, 2)`. Data: Keilland et al. (2017).

### Takeaway

Hind foot length appears linearly related with juvenile snowshoehare body weight The effect of hind foot length on juvenile hare weight is moderate (Pearson's *r* = `r round(juv_hares_pearson$estimate, 2)`) but statistically significant (p < 0.001). The slope of the linear model is `r round(juv_hare_lm_tidy$estimate[2], 2)`, which suggests and expected average increase in body mass of `r round(juv_hare_lm_tidy$estimate[2], 2)` g for each 1 mm increase in hind foot length. Despite a low p value, an $R^2$ value of just `r round(juv_hare_lm_glance$r.squared, 2)` suggests that only `r round(juv_hare_lm_glance$r.squared, 2)*100`% of the variance in juvenile snowshoe hare weight can be accounted for by this model. This is a low number, and suggests that a simple linear model may not be the best way to explore this data.

Observing diagnostic plots of this data solidifies this concern that a simple linear model is not the best fit. The residual vs. fitted plot revealed the data to be heteroscedastic, with residual values increasing as weight increases. The Q-Q diagnostic plot also revealed residuals that are not very normally distributed, particularly at low weights. These diagnostic plots suggest that we are missing important variables in our model, and perhaps a multiple regression or another model would be a more appropriate fit. It would be wise to explore changes in body weight as they relate to sex and site, since exploratory boxplots (**Figure 2**) suggested that these factors may have an effect on juvenile hare weights.

# Summary

Exploratory data analysis reveals the following: 

- The number of juvenile snowshoe hares observed each year at the Bonanza Creek Long Term Ecological Research site generally decreased between `r min(juv_hares_annual_count$year)` and `r max(juv_hares_annual_count$year)`.
- Male juvenile snowshoe hares have larger mean and median weights than female juvenile snowshoe hares; while the effect size of sex on body weight is small, it is statistically significant.
- Juvenile hares are larger at the Bonanza Black Spruce site.
- Juvenile hare weight is positively correlated with hind foot length; the relationship by a simple linear regression model is moderate but statistically significant, with a slope of `r round(juv_hare_lm_tidy$estimate[2], 2)` g/mm. However, diagnostic exploratory plots reveal that a simple linear model is likely not the best way to explore this data, and the $R^2$ value is low (`r round(juv_hare_lm_glance$r.squared, 2)`).

Next steps to take include:

- Multiple linear regression should be run to understand the affects of sex and site in addition to hind foot length on juvenile hare weights.
- Adult hare weight data should be analyzed in a similar fashion to this report in order to assess how well hares are surviving at the different sites.

